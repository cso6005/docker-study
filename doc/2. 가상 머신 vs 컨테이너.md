
# 가상 머신 vs 도커 컨테이너

왜 재현 가능한 환경적인 문제를 virtual machine으로 해결할 수 없는 것 인가?

## 1. Virtual Machine

 virtual machine 은 호스트 운영 체제에 독립적인 자체 셀을 지닌 캡슐화된 가상 운영 체제를 지닌다.

Virtual machine 으로 사용한다는 것은 호스트 운영 체제 즉, 윈도우 또는 맥 os 또는 리눅스가 있을 때, 

그 위에 버츄얼 머신을 설치한다는 것이다. 즉, 컴퓨터 내부의 컴퓨터인 것이다.

이 virtual machine 에는 그 virtual machine 내부에서 실행되는 자체 운영 체제인 가상 운영 체제가 있다. 

예를 들어 가상 운영 체제가 리눅스라고 하자.

이 버츄얼 머신은 컴퓨터와 같기 때문에 버츄얼 머신에서 emulate를 할 수 있고 버츄얼 머신 내부에 추가 도구를 설치할 수 있다. 

그것은 가상으로 존재하지만 다른 머신이기 때문에 우리는 거기에 원하는 무엇이든 설치할 수 있다. 

필요한 모든 라이브러리, dependency 및 도구를 설치한 다음 소스 코드를 그 위치로 이동할 수있다.

따라서 프로그램에 필요한 모든 것과 거기에 설치되는 모든 도구가 포함된 캡슐화된 버츄얼 머신이기 때문에

도커, 컨테이너와 동일한 결과를 얻을 수 있는 것이다. 모든 것이 보유된 캡슐화된 환경인 것이다. 

그런 다음 서로 다른 프로젝트에 대해 이러한 환경을 여러 개 둘 수 있으며,

또는 버츄얼 머신 구성을 동료와 공유하여 동일한 환경에서 작업하고 있는지 확인 할 수 있다. 

### 장점

1. 분리된 환경
2. 분리된 환경 속에서 환경 별로 별도의 구성을 가질 수 있다.
3. 모든 것을 안정적으로 공유 가능하고, 재생산할 수 있다. 

## 2. Virtural Machine 문제점

1. **가상 운영 체제를 지닌 여러 버츄얼 머신에서 발생하는 오버헤드**

모든 버츄얼 머신은 실제로 우리 머신 위에서 실행되는 스탠드얼론 컴퓨터와 같다.

따라서 이러한 머신이 여러 대 있는 경우, 우리의 컴퓨터 위에 여러 컴퓨터를 심는 것과 같으니,

당연히 메모리, CPU, 또는 우리 하드 드라이브의 공간을 낭비하게 된다.

그래서 시스템에 버츄얼 머신이 점점 더 많아지면 큰 성능 악화가 될 것이다.

2. **중복 복제로 인한 낭비되는 공간 발생**

항상 동일하게 복제되는 많은 것들이 여전히 준재한다. 특히 운영 체제가 그렇다.

모든 버츄얼 머신에서 리눅스를 사용한다고 해도 여전히 모든 머신에 별도로 설치되어 있다. 

또한 모든 버츄얼 머신에 다른 많은 도구가 설치되어 있다.

이 도구는 애플리케이션이 직접적으로 필요하지 않지만 여전히 디폴트로 설정되어 있기 때문에 필요하지 않은 것들로 공간을 낭비하게 된다. 

즉, 가상머신은 환경을 캠슐화하기는 하지만 앱과 앱을 실행시키기 위해 필요한 것 뿐만 아니라,

컴퓨터 전체를 캡슐화하기 때문에 많은 공간을 낭비하게 된다.

특히나 prod 환경에서는 이러한 문제는 큰 악영향을 끼칠 것이다. 

3. **재생산 및 공유가 되지만 하기 까다로움**

재생산 및 공유가 가능하더라도 원하는 모든 시스템에 그 버츄얼 머신을 설정해야 하고

정확히 동일한 방식으로 구성해야 하기 때문에 까다로울 수 있다. 공유할 수 있는 단일 구성 파일이 없는 것이다. 

개발에서 제품 생산으로 애플리케이션을 배포하려면 버츄얼 머신과 동일한 방식로 프로덕션 머신을 구성해야 한다. 

## 3. 도커가 컨테이너를 구축 및 관리하는 동작

우리의 OS 위에 OS Built-in / Emulated Container Support 계층이 있다.

해당 계층은 운영체제가 기본적으로 내재하고 있거나 컨테이너 에뮬레이트를 지원하는 내장 컨테이너를 활용한다. 도커는 이것이 작동하도록 처리한다.

그리고 그 위 계층에 docker engine  도구를 실행한다. (우리가 그것을 설치 할 때 도커에 의해 모두 설정됨 )

그리고 도커 엔진을 위에 각각의 컨테이너가 도커엔진을 기반으로하여 가동된다.

여기서 중요한 점은 **도커엔진은 가벼운 소형도구가 설치되어있는, 컨테이너를 구축 관리하는 하나의 도구일 뿐이라는 것이다.**

<br>

### 컨테이너가 더 낫은 점

1. **OS에 영향을 덜 주며, 매우 빠르고, 공간 낭비를 줄이기에 가상머신에 비해 성능이 좋다.**

컨테이너에는 코드와 코드에 필요한 도구 및 런타임이 포함되어 있지만 운영 체제, 수 많은 추가 도구 또는 이와 유사한 것들이 차지하고 있지 않다.

즉, 불필요한 것들이 공간을 차지하고 있지 않는 것이다.

컨테이너 내부에 작은 운영 체제 레이어가 있을 순 있지만 버츄얼 머신에 설치하는 것보다

훨씬 작은 운영 체제의 매우 가벼운 버전을 가질 것이다. 

2. **공유 및 재배포가 빠르다.**

구성파일을 사용하여 컨테이너를 구성하고 해당 구성파일은 명세로서 컨테이너를 설명할 수 있다. 

이를 공유하여 다른 사람들이 컨테이너를 다시 만들 수 있도록 하거나, 컨테이너를 이미지로 빌드할 수 있다.

그 이미지를 다른 사람과 공유하여 모든 사람이 나와 동일한 컨테이너로 시작할 수 있도록 한다.

가상머신의 경우, 공유 및 재배호가 도커에 비해 까다롭다.
